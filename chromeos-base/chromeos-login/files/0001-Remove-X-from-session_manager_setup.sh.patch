From c72494b84436ff85f7282cd2d43ffe371adce3c1 Mon Sep 17 00:00:00 2001
From: Simon Que <sque@chromium.org>
Date: Sun, 24 Jun 2012 17:33:09 -0700
Subject: [PATCH] Remove X from session_manager_setup.sh

Change-Id: Ic6fe86997cbe9fb6e01be4939ec64edad295def8
Signed-off-by: Simon Que <sque@chromium.org>
---
 init/ui.conf             | 11 -----------
 session_manager_setup.sh | 17 -----------------
 2 files changed, 28 deletions(-)

diff --git a/init/ui.conf b/init/ui.conf
index 72b98f1..96954b6 100644
--- a/init/ui.conf
+++ b/init/ui.conf
@@ -42,17 +42,6 @@ env UI_LOG_DIR=/var/log/ui
 env UI_LOG_FILE=ui.LATEST
 
 pre-start script
-  X_SOCKET_DIR=/tmp/.X11-unix
-  X_ICE_DIR=/tmp/.ICE-unix
-  mkdir -p $X_SOCKET_DIR $X_ICE_DIR
-  chown root:root $X_SOCKET_DIR $X_ICE_DIR
-  chmod 1777 $X_SOCKET_DIR $X_ICE_DIR
-
-  # XKB writes keymaps here; otherwise things like Ctrl-Alt-Fx VT switching
-  # don't work.
-  mkdir -p /var/lib/xkb
-  chown xorg:xorg /var/lib/xkb
-
   # Make sure we we can easily track UI state.
   rm -rf /var/run/state
   mkdir -p /var/run/state
diff --git a/session_manager_setup.sh b/session_manager_setup.sh
index eb0aec2..113eea5 100755
--- a/session_manager_setup.sh
+++ b/session_manager_setup.sh
@@ -4,13 +4,6 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
-# Set up to start the X server ASAP, then let the startup run in the
-# background while we set up other stuff.
-XUSER=xorg
-XTTY=1
-XAUTH_FILE="/var/run/chromelogin.auth"
-xstart.sh ${XUSER} ${XTTY} ${XAUTH_FILE} &
-
 USE_FLAGS="$(cat /etc/session_manager_use_flags.txt)"
 
 # Returns success if the USE flag passed as its sole parameter was defined.
@@ -72,8 +65,6 @@ export LOGNAME=${USER}
 export SHELL=/bin/sh
 # TODO(keescook): remove Chrome's use of $HOME.
 export HOME=${DATA_DIR}/user
-export DISPLAY=:0.0
-export XAUTHORITY=${DATA_DIR}/.Xauthority
 
 # Provide /etc/lsb-release contents and timestamp so that they are available
 # to Chrome immediately without requiring a blocking file read.
@@ -450,14 +441,6 @@ add_vmodule_pattern "*plugin*=2"
 
 wait
 
-# Create the XAUTHORITY file so ${USER} can access the X server.
-# This must happen after xstart.sh has finished (and created ${XAUTH_FILE}),
-# hence after the wait.
-cp -f ${XAUTH_FILE} ${XAUTHORITY} && chown ${USER}:${USER} ${XAUTHORITY}
-
-initctl emit x-started
-bootstat x-started
-
 # This is a bad place to add your code.  See "RED ALERT", above.
 # Regrettably, this comment is not redundant.  :-(
 
-- 
1.9.1.423.g4596e3a

