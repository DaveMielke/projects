# Copyright 2018 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

description   "Start the qrtr-ns daemon"
author        "ejcaruso@chromium.org"

start on started system-services
stop on stopping system-services

# TODO(ejcaruso, b/79088285): after log-to-syslog goes in replace this
# with "expect fork" and change the exec stanza below
expect daemon

pre-start exec qrtr-cfg 1

# qrtr-ns needs CAP_NET_ADMIN
exec minijail0 -inNlpvr --uts -S /usr/share/policy/qrtr-ns-seccomp.policy \
    -u qrtr -g qrtr -c 0x1000 \
    /usr/bin/qrtr-ns -f 2>&1 | logger -t qrtr-ns
