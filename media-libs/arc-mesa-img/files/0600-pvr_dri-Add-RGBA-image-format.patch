From 85c64c31a525df130e7e1efe5ff52933fc7e0212 Mon Sep 17 00:00:00 2001
From: Nicolas Boichat <drinkcat@google.com>
Date: Tue, 15 Dec 2015 17:18:40 +0800
Subject: [PATCH 600/605] pvr_dri: Add RGBA image format

Change-Id: I5375cb295227430870a9202f573fb1252f500f87
---
 src/mesa/drivers/dri/pvr/pvrdri.c  | 14 ++++++++++++++
 src/mesa/drivers/dri/pvr/pvrutil.c |  2 ++
 2 files changed, 16 insertions(+)

diff --git a/src/mesa/drivers/dri/pvr/pvrdri.c b/src/mesa/drivers/dri/pvr/pvrdri.c
index f179871..71f95cc 100644
--- a/src/mesa/drivers/dri/pvr/pvrdri.c
+++ b/src/mesa/drivers/dri/pvr/pvrdri.c
@@ -1111,6 +1111,20 @@ static IMG_PIXFMT PVRDRIGetPixelFormat(const struct gl_config *psGLMode)
 				}
 			}
 
+			if (psGLMode->redMask   == 0x000000FF &&
+			    psGLMode->greenMask == 0x0000FF00 &&
+			    psGLMode->blueMask  == 0x00FF0000)
+			{
+				if (psGLMode->alphaMask == 0xFF000000)
+				{
+					return IMG_PIXFMT_R8G8B8A8_UNORM;
+				}
+				else if (psGLMode->alphaMask == 0)
+				{
+					return IMG_PIXFMT_R8G8B8X8_UNORM;
+				}
+			}
+
 			__driUtilMessage("%s: Unsupported buffer format", __func__);
 			return IMG_PIXFMT_UNKNOWN;
 
diff --git a/src/mesa/drivers/dri/pvr/pvrutil.c b/src/mesa/drivers/dri/pvr/pvrutil.c
index 0395fad..69d9e27 100644
--- a/src/mesa/drivers/dri/pvr/pvrutil.c
+++ b/src/mesa/drivers/dri/pvr/pvrutil.c
@@ -286,6 +286,8 @@ const __DRIconfig **PVRDRICreateConfigs(void)
 		{
 			MESA_FORMAT_B8G8R8A8_UNORM,
 			MESA_FORMAT_B8G8R8X8_UNORM,
+			MESA_FORMAT_R8G8B8A8_UNORM,
+			MESA_FORMAT_R8G8B8X8_UNORM,
 			MESA_FORMAT_B5G6R5_UNORM
 		};
 	uint8_t auDepthBits[] = { 0, 32 };
-- 
2.8.0.rc3.226.g39d4020

