From 2adf26f53a03c4e1cb18689b7848129448e1d5a1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Marchesin?= <marcheu@chromium.org>
Date: Tue, 17 Apr 2012 18:16:18 -0700
Subject: [PATCH 04/19] CHROMIUM: i965: Allow the case where multiple flush
 types are enqueued.

This happens when the miptree is allocated with intel_miptree_alloc_hiz
which adds NEED_HIZ_RESOLVE and then NEED_DEPTH_RESOLVE is added to it.

BUG=none
TEST=by hand

Signed-off-by: Prince Agyeman <prince.agyeman@intel.com>
Signed-off-by: Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Signed-off-by: James Ausmus <james.ausmus@intel.com>

Conflicts:
	src/mesa/drivers/dri/i965/intel_resolve_map.c

Signed-off-by: Tomasz Figa <tfiga@chromium.org>
---
 src/mesa/drivers/dri/i965/intel_resolve_map.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/mesa/drivers/dri/i965/intel_resolve_map.c b/src/mesa/drivers/dri/i965/intel_resolve_map.c
index 5b132ca..2993fa0 100644
--- a/src/mesa/drivers/dri/i965/intel_resolve_map.c
+++ b/src/mesa/drivers/dri/i965/intel_resolve_map.c
@@ -38,8 +38,7 @@ intel_resolve_map_set(struct exec_list *resolve_map,
                       unsigned need)
 {
    foreach_list_typed(struct intel_resolve_map, map, link, resolve_map) {
-      if (map->level == level && map->layer == layer) {
-         map->need = need;
+      if (map->level == level && map->layer == layer && map->need == need) {
 	 return;
       }
    }
-- 
2.8.0.rc3.226.g39d4020

