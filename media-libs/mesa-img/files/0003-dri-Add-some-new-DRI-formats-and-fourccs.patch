From 661cdae53c04eae3ca5d2865b160c557eab4890a Mon Sep 17 00:00:00 2001
From: Frank Binns <frank.binns@imgtec.com>
Date: Fri, 14 Sep 2018 08:56:27 +0100
Subject: [PATCH 03/33] dri: Add some new DRI formats and fourccs

Add ARGB4444 DRI format and fourcc.
---
 include/GL/internal/dri_interface.h    | 2 ++
 src/mesa/drivers/dri/common/dri_util.c | 4 ++++
 2 files changed, 6 insertions(+)

diff --git a/include/GL/internal/dri_interface.h b/include/GL/internal/dri_interface.h
index 319a1fe..008c959 100644
--- a/include/GL/internal/dri_interface.h
+++ b/include/GL/internal/dri_interface.h
@@ -1254,6 +1254,7 @@ struct __DRIdri2ExtensionRec {
 #define __DRI_IMAGE_FORMAT_XBGR2101010  0x1010
 #define __DRI_IMAGE_FORMAT_ABGR2101010  0x1011
 #define __DRI_IMAGE_FORMAT_SABGR8       0x1012
+#define __DRI_IMAGE_FORMAT_ARGB4444     0x1013
 
 #define __DRI_IMAGE_USE_SHARE		0x0001
 #define __DRI_IMAGE_USE_SCANOUT		0x0002
@@ -1284,6 +1285,7 @@ struct __DRIdri2ExtensionRec {
 #define __DRI_IMAGE_FOURCC_ARGB1555	0x35315241
 #define __DRI_IMAGE_FOURCC_R16		0x20363152
 #define __DRI_IMAGE_FOURCC_GR1616	0x32335247
+#define __DRI_IMAGE_FOURCC_ARGB4444	0x32315241
 #define __DRI_IMAGE_FOURCC_RGB565	0x36314752
 #define __DRI_IMAGE_FOURCC_ARGB8888	0x34325241
 #define __DRI_IMAGE_FOURCC_XRGB8888	0x34325258
diff --git a/src/mesa/drivers/dri/common/dri_util.c b/src/mesa/drivers/dri/common/dri_util.c
index 75d1240..39198f2 100644
--- a/src/mesa/drivers/dri/common/dri_util.c
+++ b/src/mesa/drivers/dri/common/dri_util.c
@@ -872,6 +872,8 @@ driGLFormatToImageFormat(mesa_format format)
       return __DRI_IMAGE_FORMAT_RGB565;
    case MESA_FORMAT_B5G5R5A1_UNORM:
       return __DRI_IMAGE_FORMAT_ARGB1555;
+   case MESA_FORMAT_B4G4R4A4_UNORM:
+      return __DRI_IMAGE_FORMAT_ARGB4444;
    case MESA_FORMAT_B8G8R8X8_UNORM:
       return __DRI_IMAGE_FORMAT_XRGB8888;
    case MESA_FORMAT_B10G10R10A2_UNORM:
@@ -907,6 +909,8 @@ driImageFormatToGLFormat(uint32_t image_format)
    switch (image_format) {
    case __DRI_IMAGE_FORMAT_RGB565:
       return MESA_FORMAT_B5G6R5_UNORM;
+   case __DRI_IMAGE_FORMAT_ARGB4444:
+      return MESA_FORMAT_B4G4R4A4_UNORM;
    case __DRI_IMAGE_FORMAT_ARGB1555:
       return MESA_FORMAT_B5G5R5A1_UNORM;
    case __DRI_IMAGE_FORMAT_XRGB8888:
-- 
2.7.4

