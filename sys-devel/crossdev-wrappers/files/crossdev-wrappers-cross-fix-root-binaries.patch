--- a/etc/portage/bashrc	2010-06-15 16:46:22.000000000 -0700
+++ b/etc/portage/bashrc	2010-06-15 16:53:18.000000000 -0700
@@ -8,10 +8,15 @@
 		cmdline+=" -e ^${EM}[[:space:]]";        
 	done
 	output="$( cd ${D} && scanelf -RmyBF%a . | grep -v ${cmdline} )"
 	[[ $output != "" ]] && { echo; echo "* Wrong EM_TYPE. Expected ${E_MACHINE}"; echo -e "${output}"; echo; exit 1; }
 }
 
 # We dont functionize this to avoid sandboxing.
 if [[ $EBUILD_PHASE == "postinst" ]]; then
-	[[ $EMERGE_FROM != binary ]] && cross-fix-root ${CHOST}
+	# chromiumos hack: only fix-root for build_packages
+	# Old behavior was to fix-root SYSROOT but that doesn't make any
+	# if SYSROOT != ROOT.
+	if [[ $(readlink -f "${SYSROOT}") == $(readlink -f "${ROOT}") ]]; then 
+		cross-fix-root ${SYSROOT}
+	fi
 fi
