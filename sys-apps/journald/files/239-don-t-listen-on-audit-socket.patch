From 05f328b4ec4ad202df1a662d4770e04c5e45c0a0 Mon Sep 17 00:00:00 2001
From: Chris Morin <cmtm@google.com>
Date: Tue, 4 Dec 2018 16:45:59 -0800
Subject: [PATCH] don't listen on audit socket

Audit messages are already forwarded to the kernel message buffer since
we don't have auditd running. Listening on the audit socket would result
in duplicate messages showing up in the logs.
---
 src/journal/journald-server.c | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/src/journal/journald-server.c b/src/journal/journald-server.c
index d5f4406a1..6a241b93f 100644
--- a/src/journal/journald-server.c
+++ b/src/journal/journald-server.c
@@ -1826,12 +1826,8 @@ int server_init(Server *s) {
         if (r < 0)
                 return r;
 
-        /* Unless we got *some* sockets and not audit, open audit socket */
-        if (s->audit_fd >= 0 || no_sockets) {
-                r = server_open_audit(s);
-                if (r < 0)
-                        return r;
-        }
+        /* Don't listen on audit socket */
+        (void)no_sockets;
 
         r = server_open_kernel_seqnum(s);
         if (r < 0)
-- 
2.20.0.405.gbc1bbc6f85-goog

