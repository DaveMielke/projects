From becd1079d7892ce7c34da098c6e750854eb6ce32 Mon Sep 17 00:00:00 2001
From: XinfengZhang <carl.zhang@intel.com>
Date: Thu, 26 Jul 2018 18:45:08 +0800
Subject: [PATCH] add check for external surface alignments

to check whether the external surface is aligned already

Signed-off-by: XinfengZhang <carl.zhang@intel.com>
---
 media_driver/linux/common/ddi/media_libva_util.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/media_driver/linux/common/ddi/media_libva_util.cpp b/media_driver/linux/common/ddi/media_libva_util.cpp
index c3f9b24..51b5715 100644
--- a/media_driver/linux/common/ddi/media_libva_util.cpp
+++ b/media_driver/linux/common/ddi/media_libva_util.cpp
@@ -458,6 +458,11 @@ VAStatus DdiMediaUtil_AllocateSurface(
     {
         gmmParams.BaseWidth         = mediaSurface->iWidth;
         gmmParams.BaseHeight        = mediaSurface->iHeight;
+        //to check whether the input parameter is aligned
+        if((mediaSurface->pSurfDesc->uiOffsets[1] - mediaSurface->pSurfDesc->uiOffsets[0]) > (pitch * mediaSurface->iHeight))
+        {
+            gmmParams.BaseHeight    = alignedHeight;
+        }
     }
     else
     {
-- 
1.8.3.1

