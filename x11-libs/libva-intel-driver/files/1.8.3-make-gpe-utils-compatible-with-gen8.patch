From e35a5d294561ce78f6e978759841fb4c2bb47c91 Mon Sep 17 00:00:00 2001
From: laureatian <tiantian.wang@intel.com>
Date: Mon, 21 Aug 2017 16:42:01 -0400
Subject: [PATCH 1/7] make gpe utils compatible with gen8

Signed-off-by: Wang Tiantian <tiantian.wang@intel.com>
---
 src/i965_gpe_utils.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/src/i965_gpe_utils.c b/src/i965_gpe_utils.c
index 403ba91..65f7763 100644
--- a/src/i965_gpe_utils.c
+++ b/src/i965_gpe_utils.c
@@ -2663,6 +2663,7 @@ gen9_add_2d_gpe_surface(VADriverContextP ctx,
                         int index)
 {
     struct i965_driver_data *i965 = i965_driver_data(ctx);
+    struct i965_gpe_table *gpe = &i965->gpe_table;
     struct i965_gpe_resource gpe_resource;
     struct i965_gpe_surface gpe_surface;
 
@@ -2682,7 +2683,7 @@ gen9_add_2d_gpe_surface(VADriverContextP ctx,
             gpe_surface.is_16bpp = 1;
     }
 
-    gen9_gpe_context_add_surface(gpe_context, &gpe_surface, index);
+    gpe->context_add_surface(gpe_context, &gpe_surface, index);
     i965_free_gpe_resource(&gpe_resource);
 }
 
@@ -2693,6 +2694,7 @@ gen9_add_adv_gpe_surface(VADriverContextP ctx,
                          int index)
 {
     struct i965_driver_data *i965 = i965_driver_data(ctx);
+    struct i965_gpe_table *gpe = &i965->gpe_table;
     struct i965_gpe_resource gpe_resource;
     struct i965_gpe_surface gpe_surface;
 
@@ -2704,7 +2706,7 @@ gen9_add_adv_gpe_surface(VADriverContextP ctx,
     gpe_surface.cacheability_control = i965->intel.mocs_state;
     gpe_surface.v_direction = 2;
 
-    gen9_gpe_context_add_surface(gpe_context, &gpe_surface, index);
+    gpe->context_add_surface(gpe_context, &gpe_surface, index);
     i965_free_gpe_resource(&gpe_resource);
 }
 
@@ -2718,6 +2720,7 @@ gen9_add_buffer_gpe_surface(VADriverContextP ctx,
                             int index)
 {
     struct i965_driver_data *i965 = i965_driver_data(ctx);
+    struct i965_gpe_table *gpe = &i965->gpe_table;
     struct i965_gpe_surface gpe_surface;
 
     memset(&gpe_surface, 0, sizeof(gpe_surface));
@@ -2729,7 +2732,7 @@ gen9_add_buffer_gpe_surface(VADriverContextP ctx,
     gpe_surface.size = size;
     gpe_surface.offset = offset;
 
-    gen9_gpe_context_add_surface(gpe_context, &gpe_surface, index);
+    gpe->context_add_surface(gpe_context, &gpe_surface, index);
 }
 
 void
@@ -2741,6 +2744,7 @@ gen9_add_buffer_2d_gpe_surface(VADriverContextP ctx,
                                int index)
 {
     struct i965_driver_data *i965 = i965_driver_data(ctx);
+    struct i965_gpe_table *gpe = &i965->gpe_table;
     struct i965_gpe_surface gpe_surface;
 
     memset(&gpe_surface, 0, sizeof(gpe_surface));
@@ -2751,7 +2755,7 @@ gen9_add_buffer_2d_gpe_surface(VADriverContextP ctx,
     gpe_surface.cacheability_control = i965->intel.mocs_state;
     gpe_surface.format = format;
 
-    gen9_gpe_context_add_surface(gpe_context, &gpe_surface, index);
+    gpe->context_add_surface(gpe_context, &gpe_surface, index);
 }
 
 void
-- 
2.13.6

