From d0c22df7094788a58d3282a2c25483d26a3cca54 Mon Sep 17 00:00:00 2001
From: "Xiang, Haihao" <haihao.xiang@intel.com>
Date: Wed, 3 Jun 2015 09:42:03 +0800
Subject: [PATCH] dec/vp8: fix segmentation update

Segment-based adjustments only occur if segmentation is enabled ($9.3).

Cc: Zhao Yakui <yakui.zhao@intel.com>
Tested-by: Charles, Daniel <daniel.charles@intel.com>
Acked-by: Zhao, Yakui <yakui.zhao@intel.com>
Signed-off-by: Xiang, Haihao <haihao.xiang@intel.com>
Signed-off-by: Sean V Kelley <seanvk@posteo.de>
---
 src/gen8_mfd.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/gen8_mfd.c b/src/gen8_mfd.c
index f045ca4..c15184d 100644
--- a/src/gen8_mfd.c
+++ b/src/gen8_mfd.c
@@ -2834,7 +2834,8 @@ gen8_mfd_vp8_pic_state(VADriverContextP ctx,
                   pic_param->pic_fields.bits.sign_bias_golden << 12 |
                   pic_param->pic_fields.bits.loop_filter_adj_enable << 11 |
                   pic_param->pic_fields.bits.mb_no_coeff_skip << 10 |
-                  pic_param->pic_fields.bits.update_mb_segmentation_map << 9 |
+                  (enable_segmentation &&
+                   pic_param->pic_fields.bits.update_mb_segmentation_map) << 9 |
                   pic_param->pic_fields.bits.segmentation_enabled << 8 |
                   (enable_segmentation &&
                    !pic_param->pic_fields.bits.update_mb_segmentation_map) << 7 |
--
2.1.4
